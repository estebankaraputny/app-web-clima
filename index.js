// ARRAY DE JUGETES 
const productsToys = [
    {
        titleProduct: "Pelota Al Hilm Pro Final Qatar 2022 Edicion Especial N5",
        descriptionProduct: "Pelota de la final de la copa Qatar 2022, Argentina campeón del mundo",
        stock: 10,
        category: "Deportes",
        imageProduct:'https://http2.mlstatic.com/D_NQ_NP_741864-MLA53161544064_012023-O.webp',
        idProduct: 1,
        price: 2600
    },
    {

        titleProduct: "Cheerwing Helicóptero Azul",
        descriptionProduct: "Este Syma S107 Mini RC Helicóptero es el más duradero y estable del mundo. El artículo viene con el último sistema Gyro para control de precisión. La estructura de metal ha demostrado soportar decenas de colisiones. El minihelicóptero carga directamente desde el conductor que utiliza pilas de tipo AA y tiene un control para recortar funciones completas para el vuelo perfecto.",
        stock: 4,
        category: "Control Remoto",
        imageProduct:'https://http2.mlstatic.com/D_NQ_NP_850834-MLA52876570949_122022-O.webp',
        idProduct: 2,
        price: 200
    },
    {
        titleProduct: "Skate Kalima Maple Pro",
        descriptionProduct: "Deck maple canadiense medidas: 8, Lija goma Negra Ruedas Kalima TRANS 51mm y Trucks de aluminio y acero templado",
        stock: 2,
        category: "Deportes",
        imageProduct:'https://http2.mlstatic.com/D_NQ_NP_879658-MLA42197351692_062020-O.webp',
        idProduct: 3,
        price: 180
    },
    {
        titleProduct: "Monopoly Clásico Hasbro C1009",
        descriptionProduct: "¡Un clásico! Reuní a tus amistades para disfrutar de horas de risas y diversión mientras juegan a ser agentes inmobiliarios con el Monopoly. Deberán comprar, vender e intercambiar propiedades estratégicamente para aumentar sus fortunas, si te declarás en quiebra... ¡perdiste!",
        stock: 5,
        category: "Juegos de Mesa",
        imageProduct:'https://http2.mlstatic.com/D_NQ_NP_852178-MLA44678979171_012021-O.webp',
        idProduct: 4,
        price: 80
    },
    {
        titleProduct: "Cubo Rubik 3x3 Moyu Meilong 3x3x3 De Velocidad",
        descriptionProduct: "Diviertete con el nuevo diseño del legendario cubo de Rubiks, compite con tus amigos para armarlo en el menor tiempo posible, Dentro del instructivo podrás encontrar una página de internet en donde encontraras diferentes formas de armarlo.",
        stock: 3,
        category: "Juegos de Mesa",
        imageProduct:'https://http2.mlstatic.com/D_NQ_NP_836663-MLA52310848906_112022-O.webp',
        idProduct: 5,
        price: 500
    },
    {
        titleProduct: "Buzz Lightyear Figura De Accion 30 Cm Toy Story",
        descriptionProduct: "Cuerpo de plástico con brazos, piernas, cabeza, muñecas y cintura articulados. Casco con visera retráctil.",
        stock: 10,
        category: "Figuras de Acción",
        imageProduct:'https://http2.mlstatic.com/D_NQ_NP_689190-MLA50317134187_062022-O.webp',
        idProduct: 6,
        price: 100
    },
    {
        titleProduct: "Sony PlayStation 5 825GB Standard",
        descriptionProduct: "Con tu consola PlayStation 5 tendrás entretenimiento asegurado todos los días. Su tecnología fue creada para poner nuevos retos tanto a jugadores principiantes como expertos.",
        stock: 10,
        category: "Videojuegos",
        imageProduct:'https://http2.mlstatic.com/D_NQ_NP_841787-MLA44484414455_012021-O.webp',
        idProduct: 7,
        price: 2300
    },
    {
        titleProduct: "Cocinita Con Accesorios",
        descriptionProduct: "Excelente juego e cocina infantil marca Dibu-Toys con accesorios, fabricado con plástico PVC, libre de materiales tóxicos y amigable con el medio ambiente. Ideal para niños de 1 año a 6 años.",
        stock: 14,
        category: "Juguetes de Oficio",
        imageProduct:'https://http2.mlstatic.com/D_NQ_NP_676339-MLA45608086908_042021-O.webp',
        idProduct: 8,
        price: 100
    },
    {
        titleProduct: "Dragon Ball Super Goku Ultra Instinto",
        descriptionProduct: "18 a 19 cm de pura potencia de excelente calidad y terminación.",
        stock: 10,
        category: "Figuras de Acción",
        imageProduct:'https://http2.mlstatic.com/D_NQ_NP_964667-MLA47754955710_102021-O.webp',
        idProduct: 9,
        price: 120
    },
    {
        titleProduct: "Peluche Ely",
        descriptionProduct: "Peluche de Ely de pocoyo, suavidad y calidad, 27cm",
        stock: 10,
        category: "Peluches",
        imageProduct:'https://http2.mlstatic.com/D_NQ_NP_843272-MLA49075885962_022022-O.webp',
        idProduct: 10,
        price: 100
    },
    {
        titleProduct: "Peluche Pocoyo",
        descriptionProduct: "Peluche de Pocoyo, suavidad y calidad, 27cm",
        stock: 10,
        category: "Peluches",
        imageProduct:'https://http2.mlstatic.com/D_NQ_NP_704591-MLA43027485845_082020-O.webp',
        idProduct: 11,
        price: 110
    },
    {
        titleProduct: "Lampara Velador Proyector Estrella Luna Luz Rgb 360 Usb",
        descriptionProduct: "Este proyector de estrellas es ideal para la habitación de un bebé, de un niño, para decorar bodas, cumpleaños y otras fiestas. Es un gran velador romántico y decorativo.",
        stock: 10,
        category: "Iluminación",
        imageProduct:'https://http2.mlstatic.com/D_NQ_NP_644129-MLA52910054366_122022-O.webp',
        idProduct: 12,
        price: 150
    },
    {
        titleProduct: "Auto Jeep Radio Control Remoto Spiderman Babymovil",
        descriptionProduct: "Auto Radio Control SpidermanAvanza y retrocede ¡Prepárate para la accion y divertite con tu personaje favorito de Marvel Spiderman! Medidas: 18cm*10cm*8cm",
        stock: 10,
        category: "Control Remoto",
        imageProduct:'https://http2.mlstatic.com/D_NQ_NP_701617-MLA53007226439_122022-O.webp',
        idProduct: 13,
        price: 150
    },
    {
        titleProduct: "Dinosaurio Camina Ruge Luz Y Pone Huevos",
        descriptionProduct: "DINOSAURIO TYRANNOSAURUS CAMINA, RUGE, LUZ Y PONE HUEVOS - IDEAL PARA REGALAR Y SORPRENDER!!!",
        stock: 10,
        category: "Figuras de Acción",
        imageProduct:'https://http2.mlstatic.com/D_NQ_NP_990880-MLA49960262552_052022-O.webp',
        idProduct: 14,
        price: 200
    },
    {
        titleProduct: "Ametralladora Luces Sonidos Laser Tripode Vibración Disparo",
        descriptionProduct: "Puntero laser, Largo 62 cm, Con tripode, Con tripode",
        stock: 10,
        category: "Juguetes de Oficio",
        imageProduct:'https://http2.mlstatic.com/D_NQ_NP_891527-MLA48347840129_112021-O.webp',
        idProduct: 15,
        price: 150
    }
]


const developers = [
    {
        name: "Esteban Karaputny",
        github:"https://github.com/estebankaraputny",
        linkdin: "https://www.linkedin.com/in/esteban-karaputny-9149171ab/"
    },
    {
        name: "Brisa Alvarez",
        github:"https://github.com/bbrialvarez",
        linkdin:"https://www.linkedin.com/mwlite/in/brisa-%C3%A1lvarez-5a211622a"
    },
    {
        name: "Cesar Ferreyra",
        github:"https://github.com/CesarFerrey",
        linkdin: "www.linkedin.com/in/cesar-ferreyra-vadnal"
    },
    {
        name: "Franco Guerra",
        github:"https://github.com/FrancoLguerra",
        linkdin: "https://www.linkedin.com/in/franco-luis-guerra/"
    }
]


// EVENTO ONLOAD PARA CARGAR LA PAGINA
// const contentLoader = document.getElementById("loader");

function fadeOut(el) {
    el.style.opacity = 1;
    (function fade() {
        if ((el.style.opacity -= .1) < 0) {
            el.style.display = "none";
        } else {
            requestAnimationFrame(fade);
        }
    })();
};

// ** FADE IN FUNCTION **
function fadeIn(el, display) {
    el.style.opacity = 0;
    el.style.display = display || "block";
    (function fade() {
        var val = parseFloat(el.style.opacity);
        if (!((val += .1) > 1)) {
            el.style.opacity = val;
            requestAnimationFrame(fade);
        }
    })();
};

const loaderPage = document.querySelector("#loader");
const bodyPage = document.querySelector("body")

window.onload = function(){
    fadeOut(loaderPage);
    bodyPage.classList.remove("hiddenBody");
};



// EFECT TOGGLE IN BUTTON MENU 

const botonMenu = document.getElementById("botonMenu");
const linksMenu = document.getElementById("contentLinks");

botonMenu.addEventListener("click",() =>{
    linksMenu.classList.toggle(`activo`)
});



// RENDERIZAR PRODUCTOS 

const contentCards = document.getElementById("contentCards");
let card = `
<div class="content__messageErr" id="messageError">
</div>
`;




// SE EJECUTA LA FUNCION RENDER CARDS SI LA URL TERMINA EN INDEX.HTML 
      
if (window.location.pathname === "/index.html") {
    
    const renderCards = () => {
        
        productsToys.map((product) => {
        return (card += `
                    
            <div class="card" style="width: 18rem; id="cardToy">
                    <img src="${product.imageProduct}" class="card-img-top" alt="...">
                    <div class="card-body">
                        <span class="hidden span" id="${product.idProduct}"></span>
                        <h5 class="card-title">${product.titleProduct}</h5>
                        <h5 class="category d-none">${product.category}</h5>

                        <p class="card-price">$${product.price}</p>
                        <button class="btn btn-addToCart gradient" id="buttonAddCart">Agregar al carrito</button>
                        <a href="./pages/details.html" class="btn card-direccion gradient">Ver más</a>
                    </div>
            </div>
            
            `);
        });
        contentCards.innerHTML = card;
    }
    renderCards();
    
    
// FILTRO POR BUSQUEDA
    
    
    const searchToys = document.getElementById("inputSearch");
    const cardsToys = document.querySelectorAll(".card");
    
    // console.log(searchToys);
    
    searchToys.addEventListener("keyup", (event) =>{
      let toysHidden = [];
      
      // console.log(event.target.value.toLowerCase())
      
    
      if (event.target.matches("#inputSearch")){
          cardsToys.forEach(toy =>{
              toy.textContent.toLowerCase().replace(" ", "-").includes(event.target.value.toLowerCase().replace(" ", "-"))
              ? toy.classList.remove("hidden")
              : toy.classList.add("hidden")
    
              
              if(toy.classList.contains("hidden")){
                  toysHidden.push(toy)
              }
          })
      }
      const messageError = document.getElementById("messageError");
      let message = ``;
      
      if (toysHidden.length === cardsToys.length){
          message += `
          <div class="card__mensajeDeError">
              <img src="./assets/image/undraw_outer_space_re_u9vd.svg" alt="Imagen del espacio" class="img__error">
              <div class="mensaje__error">
                  <h2>No hay productos que coincidan con tu búsqueda.</h2>
                  <ul>
                      <li>Revisá la ortografía de la palabra.</li>
                      <li>Utilizá palabras más genéricas o menos palabras.</li>
                      <li>Prueba navegar por nuestro menú de categorías.</li>
                      <li>Vuelve a la página principal para seguir buscando.</li>
                  </ul>
              </div>
          </div>
          `
      }
      messageError.innerHTML = message; //Mostrara este mensaje si es que no se encuentra ningun producto
    
    });  
    

    


//Checkbox
const data_base = productsToys.map((eventos) => eventos);

const category_generador = () => {
  const cont_check_cards = document.getElementById("cont_check_cards");
  const categories = data_base.map((categories) => categories.category);

  const filter_category = categories.filter(
    (value, index) => categories.indexOf(value) === index
  );

  const categoryGenerador = filter_category.map(
    (category) => `
  
    <div>
    <input id="${category}" name="${category}" value="${category}" type="checkbox" class="input-category">
    <label for="${category}" class="check-category">${category}</label>
  </div>
    `
  );
  categoryGenerador.map(insertar=>cont_check_cards.insertAdjacentHTML("beforeend",insertar))

};

category_generador();


const cards_category=()=>{
    const cont_check_cards = document.getElementById("cont_check_cards");
    const elemt_category= document.getElementsByClassName('category');
  
    cont_check_cards.addEventListener("click",(select)=>{
      const input_checkbox=document.querySelectorAll('input[type="checkbox"]');
      const input_checket= [];
      input_checkbox.forEach((input)=>{
        if(input.checked){
          input_checket.push(input.value);
  
        }
      })
      for(let i=0;i< elemt_category.length;i++){
        if(input_checket.includes(elemt_category[i].textContent)){
          elemt_category[i].parentElement.parentElement.classList.remove("d-none");
  
        }else{
          elemt_category[i].parentElement.parentElement.classList.add("d-none");
  
        }
      }
      if(input_checket.length===0){
        for(let i=0;i< elemt_category.length;i++){
          elemt_category[i].parentElement.parentElement.classList.remove("d-none");
  
        }
      }
      
    });
  
  }
  cards_category();

  const contentRedes = document.getElementById("redesDev");
  let div = ``;

  const renderRedesFooter = () => {
  developers.map((dev) =>{
      return (
          div += `
          <div class="dev">
              <p>${dev.name}</p>
              <div>
                  <a href="${dev.linkdin}"><i class="fa-brands fa-linkedin"></i></a>
                  <a href="${dev.github}"><i class="fa-brands fa-github"></i></a>
              </div>
        </div> `
      );
  });
  contentRedes.innerHTML = div;
      };
  renderRedesFooter();
 
} else if( window.location.pathname != "/index.html"){
    // RENDERIZAR DEV EN EL FOOTER 

    const contentRedes = document.getElementById("redesDev");
    let div = ``;

    const renderRedesFooter = () => {
    developers.map((dev) =>{
        return (
            div += `
            <div class="dev">
                <p>${dev.name}</p>
                <div>
                    <a href="${dev.linkdin}"><i class="fa-brands fa-linkedin"></i></a>
                    <a href="${dev.github}"><i class="fa-brands fa-github"></i></a>
                </div>
          </div> `
        );
    });
    contentRedes.innerHTML = div;
        };
    renderRedesFooter();

}else{
    
};     

// COMIENZA LA FUNCIONALIDAD DEL CARRITO 

// Carrito 
const containerCartProducts = document.querySelector('.container__cartProducts');

// Container de los productos
const productsCart = document.querySelector(".products-cart");

// Icono del carrito 
const btnCart = document.querySelector('.content__cartIcon');

// Productos del carrito 
// const cartProducts = document.querySelector('.cart-products');



btnCart.addEventListener('click', () => {
    
    containerCartProducts.classList.toggle('hidden');
});


// Todos los productos de la tienda
const productList = document.querySelector(".content__cards");


// console.log("product", productList);

// Array de productos agregados al carrito 
const carro=JSON.parse(localStorage.getItem('carrito'));


let products=(carro!=null)?
carro: [];


// Contador del precio final 
const valorTotal = document.querySelector(".total__pagar");

//contador de productos en el carrito
const contadorProduct = document.querySelector("#contadorProducto");

   

// AGREGAR UN PRODUCTO AL CARRITO   


productList.addEventListener("click", (event) =>{
    
    if(event.target.classList.contains("btn-addToCart")) {
        const product = event.target.parentElement;
      //  console.log( product.parentElement.querySelector("img").src)
        const infoProduct = {
            title : product.querySelector("h5").textContent,
            price : Number(product.querySelector("p").textContent.slice(1)),
            quantityProduct : 1,
            id : product.querySelector("span").id,
            imageProduct : product.parentElement.querySelector("img").src
        };
        // console.log("id cuando agrego", product.querySelector("span").id);
        
        // Sumar la cantidad si el producto existe 

        const productExists = products.some(
            product => product.title === infoProduct.title
        );
        
        if(productExists) {
            const productsItem = products.map(product => {
                if(product.title === infoProduct.title) {
                    product.quantityProduct++;
                    return product;
                } else {
                    return product;
                }
            });
            products = [...productsItem];
            // console.log("producto1", product);
        } else{
            products = [...products, infoProduct];
            // console.log("producto2",product);

        }

        swal("GENIAL","Producto agregado con éxito al carrito", "success");
        localStorage.removeItem('carrito');
        localStorage.setItem('carrito', JSON.stringify(products));
        renderCart();
      //  saveProductsInLocal(products, obtenerProductosStorage);
    }


});



//ELIMINAR PRODUCTOS DEL CARRITO




const btnDelete=()=>{
const productIdElement = document.querySelectorAll(".icon-close");
let productsAux=[];
productIdElement.forEach((product)=>{


            product.addEventListener('click',event=>{
        
                let productStorage=JSON.parse(localStorage.getItem('carrito'))
                productStorage.forEach((productStorage)=>{
                  
                    let productCar=event.target.parentElement;
                    
                    if(productCar.querySelector('span').id!=productStorage.id){
                        productsAux.push(productStorage)
                    }
                })
                localStorage.removeItem('carrito')
                localStorage.setItem('carrito',JSON.stringify(productsAux))
                products=productsAux;
                renderCart()
})
        
       

})

}
      


// VACIAR CARRITO 

const botonVaciar = document.getElementById("vaciarCarrito");

 botonVaciar.addEventListener("click", (event) =>{
    localStorage.removeItem('carrito')
    valorTotal.innerText=`$0`
    contadorProduct.innerText = "0";
    products=[];
    renderCart()
})


// RENDERIZAMOS LOS PRODUCTOS AL CARRITO


const renderCart = () =>{
    


const productosCarrito = JSON.parse(localStorage.getItem('carrito')) ;
// const products = productosCarrito;
console.log(productosCarrito);
productsCart.innerHTML = "";
if(productosCarrito === null){
    productsCart.innerHTML = `
        <p class="cart-empty">No hay productos en tu carrito</p>
    `
};
let totalPrice = 0;
let productTotal = 0;
if(productosCarrito!=null){

    productosCarrito.forEach(product => {
        console.log(product.imageProduct)
        const contentProducts = document.createElement("div");
        contentProducts.classList.add("cart-products");
        contentProducts.innerHTML = `
            <img src="${product.imageProduct}" alt="imagen del producto" class="image__productCart">
            <p class="cantidad">${product.quantityProduct}</p>
            <h3 class="name-product">${product.title}</h3>
            <p class="price-product">$${product.price}</p>
            <i class="bi bi-x-lg icon-close"></i>
            <span class="hidden idCart" id="${product.id}"></span>
        `
        productsCart.appendChild(contentProducts);
        totalPrice = totalPrice + (product.quantityProduct * product.price);
        productTotal = productTotal + product.quantityProduct;
    });
}
    valorTotal.innerText = `$${totalPrice}`;
    contadorProduct.innerText = productTotal;

    console.log(valorTotal);
    btnDelete()

}
;



renderCart();
  


// PAGE DETAILS ENVIAR ID PARA SU RENDERIZACION
let idProduct = document.querySelectorAll(".span");


console.log(idProduct)

let buttonDirection = document.querySelectorAll(".card-direccion")


for(let i = 0; i < idProduct.length; i++ ){
    // console.log(idProduct[i].id)
    buttonDirection[i].addEventListener("click", () =>{
      localStorage.setItem("idOfProduct", idProduct[i].id)
    });
}


// CODIGO DE DESCUENTO 
  
  // const generateCode = () => {
      //     const code = Math.floor(Math.random() * 1000000);
      //    //genero el porcentaje de descuento (entre 10 y 70%)
  //     const percentageDiscount = Math.floor(Math.random() * 60 + 10);
  //     alert(`Su codigo de descuento es: ${code}, Con un descuento del: ${percentageDiscount}%`);
  //     localStorage.setItem("code", code);
  //     localStorage.setItem("percentageDiscount", percentageDiscount);
//   };
  





